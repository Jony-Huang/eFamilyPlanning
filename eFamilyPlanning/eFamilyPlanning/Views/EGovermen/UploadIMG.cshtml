@{
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <title>TODO supply a title</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <link href="~/Css/Jcrop.min.css" rel="stylesheet" />
    <link href="~/Css/bootstrap.min.css" rel="stylesheet" />

    <link href="~/Css/sitelogo.css" rel="stylesheet" />
    <style>
        .upload-btn {
            width: 96px;
            height: 35px;
            overflow: hidden;
            position: relative;
            /*border: 3px solid #06c;*/
            border-radius: 4px;
            /*background: #0cf;*/
        }

            .upload-btn:hover {
                background: #09f;
            }

        .upload-btn__txt {
            z-index: 998;
            position: relative;
            color: #fff;
            font-size: 18px;
            font-family: "Helvetica Neue";
            line-height: 24px;
            text-align: center;
            text-shadow: 0 1px 1px #000;
        }

        .upload-btn input {
            width: 96px;
            height: 35px;
            top: -10px;
            right: -10px;
            z-index: 999;
            position: absolute;
            cursor: pointer;
            opacity: 0;
            filter: alpha(opacity=0);
        }

}
    </style>

</head>
<body>

    <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">开始演示模态框</button>
    <!-- 模态框（Modal） -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content" style="width:1000px;margin-left:-200px;">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">模态框（Modal）标题</h4>
                </div>
                <div class="modal-body" style="height:auto;">
                    <div style="margin:10px;">
                        <label for="avatarInput" style="line-height: 35px; width:100px;">图片上传</label>
                        <!-- "js-fileapi-wrapper" -- required class -->
                        <div class="js-fileapi-wrapper upload-btn" id="choose" style=" display:inline;">

                            <input name="files" type="file" multiple />
                            @*<button id="btn" class="btn btn-success">上传</button>*@

                            <label id="avatarInput" class="btn btn-danger">请选择图片</label>
                        </div>
                        <div id="images">

                            <p style="margin-top: 40px;"></p>

                            <div id="img2" class="avatar-wrapper" style="float:left; width:700px; "></div>

                            <div id="img3"  style="float:right; margin-left:10px; border:1px solid #ddd; width:100px; height:100px;"></div>

                            
                        </div>
                        <div style="clear:both;"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary">提交更改</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>


    

    <script src="~/Scripts/jquery-1.10.2.min.js"></script>
    <script src="~/Scripts/Jcrop.min.js"></script>
    <script src="~/Scripts/bootstrap.min.js"></script>

    <script>window.FileAPI = { staticPath: '/Scripts/JsFileAPI/' };</script>
    <script src="~/Scripts/JsFileAPI/FileAPI.min.js"></script>
    <script>

        var el = $('input').get(0);


        FileAPI.event.on(el, 'change', function (evt) {
      var files = FileAPI.getFiles(evt); // Retrieve file list

      FileAPI.filterFiles(files, function (file, info){
        if( !/^image/.test(file.type)  ){
          alert('图片格式不正确');
          return false;
        }
        else if(file.size > 20 * FileAPI.MB){
          alert('图片必须小于20M');
           return false;
        }
        else{
          return true;
        }

      }, function (files, rejected){


        if( files.length ){
          var file = files[0];
           var img0 = FileAPI.Image(file);
           var img1 = FileAPI.Image(file);
           var ratio = 0;
          FileAPI.getInfo(file, function (err, info) {  //get image ratio
              if (!err) {
                if (info.width > info.height) {
                  ratio = info.width / 400;
                }
                else {
                  ratio = info.height / 400;
                }
              }
            });

            img0.resize(500, 500, 'max')   //place image and register jcrop
                .get(function(err, img) {
                  $('#img2').empty();
                  $('#img2').append($(img));

                  $('#img2').children().Jcrop({
                    aspectRatio: 1,
                    bgColor: 'rgba(0,0,0,0.4)',
                    onSelect: function(c) {
                      img1.matrix.sx = c.x * ratio;
                      img1.matrix.sy = c.y * ratio;
                      img1.matrix.sw = c.w * ratio;
                      img1.matrix.sh = c.h * ratio;
                      img1.matrix.dw = 100;
                      img1.matrix.dh = 100;

                      img1.get(function(err, img) {
                        // $('#img3').empty();
                        //   $('#img3').append($(img));
                        $('#img3').html($(img));
                      });

                    }
                  });
                });
                  $('#btn').on('click',function(){
                        FileAPI.upload({
                            url: '/EGovermen/upFile',

                          files: { images: img1 },
                          progress: function (evt){ /* ... */ },
                          complete: function (err, xhr){ /* ... */
                            //alert(xhr.responseText);

                          }
                        });

                  });

          }
        });
      });

    </script>
</body>
</html>
